{% extends "base.html" %}

{% block content %}
<h2>Hist√≥rico</h2>
<form method="get" class="mb-4">
    <div class="row">
        <div class="col-md-3">
            <label for="start_date" class="form-label">Fecha Inicio</label>
            <input type="date" class="form-control" id="start_date" name="start_date" value="{{ start_date }}">
        </div>
        <div class="col-md-3">
            <label for="end_date" class="form-label">Fecha Fin</label>
            <input type="date" class="form-control" id="end_date" name="end_date" value="{{ end_date }}">
        </div>
        <div class="col-md-2">
            <label for="sort" class="form-label">Orden</label>
            <select class="form-control" id="sort" name="sort">
                <option value="desc" {{ 'selected' if sort == 'desc' else '' }}>Descendente</option>
                <option value="asc" {{ 'selected' if sort == 'asc' else '' }}>Ascendente</option>
            </select>
        </div>
        <div class="col-md-2">
            <label for="provider" class="form-label">Proveedor</label>
            <select class="form-control" id="provider" name="provider">
                <option value="">Todos</option>
                <option value="Ollama" {{ 'selected' if provider == 'Ollama' else '' }}>Ollama</option>
                <option value="OpenAI" {{ 'selected' if provider == 'OpenAI' else '' }}>OpenAI</option>
                <option value="Scan" {{ 'selected' if provider == 'Scan' else '' }}>Scan</option>
            </select>
        </div>
        <div class="col-md-2">
            <label for="keyword" class="form-label">Palabras Clave</label>
            <input type="text" class="form-control" id="keyword" name="keyword" value="{{ keyword }}">
        </div>
    </div>
    <button type="submit" class="btn btn-primary mt-2">Filtrar</button>
    <a href="{{ url_for('history') }}" class="btn btn-secondary mt-2">Limpiar Filtros</a>
</form>
<form method="post" action="{{ url_for('audit') }}">
    <button type="submit" class="btn btn-success mb-3">Generar Reporte Combinado</button>
    {% for entry in history %}
    <div class="card mb-3">
        <div class="card-header">
            <div class="form-check">
                <input class="form-check-input" type="checkbox" name="selected_ids" value="{{ entry.id }}" id="check-{{ entry.id }}">
                <label class="form-check-label" for="check-{{ entry.id }}">
                    {{ entry.timestamp[:19] }} - {{ entry.provider }} (ID: {{ entry.id }})
                </label>
            </div>
        </div>
        <div class="card-body">
            <h5 class="card-title">Prompt</h5>
            <p class="card-text">{{ entry.prompt }}</p>
            <h5 class="card-title">Resultado</h5>
            <pre>{{ entry.result }}</pre>
        </div>
    </div>
    {% endfor %}
</form>
{% endblock %}